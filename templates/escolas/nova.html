{% extends "base.html" %}

{% block title %}Nova Escola - Sistema de Controle de Dossiê Escolar{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item"><a href="/escolas/">Escolas</a></li>
<li class="breadcrumb-item active">Nova Escola</li>
{% endblock %}

{% block content %}

<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>
                <i class="fas fa-school me-2"></i>
                Cadastrar Nova Escola
            </h1>
            <a href="{{ url_for('escola.listar') }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left me-2"></i>
                Voltar
            </a>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <form method="POST" id="formEscola">
                    <!-- Dados Básicos -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h5 class="text-primary border-bottom pb-2">
                                <i class="fas fa-info-circle me-2"></i>
                                Dados Básicos da Escola
                            </h5>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="nome" class="form-label">Nome da Escola *</label>
                            <input type="text" class="form-control" id="nome" name="nome" required
                                   placeholder="Ex: Escola Municipal João Silva">
                        </div>
                        <div class="col-md-3">
                            <label for="uf" class="form-label">UF *</label>
                            <select class="form-select" id="uf" name="uf" required>
                                <option value="">Selecione...</option>
                                <option value="AC">Acre</option>
                                <option value="AL">Alagoas</option>
                                <option value="AP">Amapá</option>
                                <option value="AM">Amazonas</option>
                                <option value="BA">Bahia</option>
                                <option value="CE">Ceará</option>
                                <option value="DF">Distrito Federal</option>
                                <option value="ES">Espírito Santo</option>
                                <option value="GO">Goiás</option>
                                <option value="MA">Maranhão</option>
                                <option value="MT">Mato Grosso</option>
                                <option value="MS">Mato Grosso do Sul</option>
                                <option value="MG">Minas Gerais</option>
                                <option value="PA">Pará</option>
                                <option value="PB">Paraíba</option>
                                <option value="PR">Paraná</option>
                                <option value="PE">Pernambuco</option>
                                <option value="PI">Piauí</option>
                                <option value="RJ">Rio de Janeiro</option>
                                <option value="RN">Rio Grande do Norte</option>
                                <option value="RS">Rio Grande do Sul</option>
                                <option value="RO">Rondônia</option>
                                <option value="RR">Roraima</option>
                                <option value="SC">Santa Catarina</option>
                                <option value="SP" selected>São Paulo</option>
                                <option value="SE">Sergipe</option>
                                <option value="TO">Tocantins</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="situacao" class="form-label">Situação</label>
                            <select class="form-select" id="situacao" name="situacao">
                                <option value="ativa" selected>Ativa</option>
                                <option value="inativa">Inativa</option>
                                <option value="suspensa">Suspensa</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-8">
                            <label for="endereco" class="form-label">Endereço Completo</label>
                            <textarea class="form-control" id="endereco" name="endereco" rows="2"
                                      placeholder="Rua, número, bairro, cidade - CEP"></textarea>
                        </div>
                        <div class="col-md-4">
                            <label for="id_cidade" class="form-label">Cidade</label>
                            <select class="form-select" id="id_cidade" name="id_cidade">
                                <option value="">Selecione a cidade...</option>
                                <!-- As cidades serão carregadas dinamicamente -->
                            </select>
                        </div>
                    </div>
                    
                    <!-- Dados Oficiais -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h5 class="text-primary border-bottom pb-2">
                                <i class="fas fa-certificate me-2"></i>
                                Dados Oficiais
                            </h5>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="cnpj" class="form-label">CNPJ</label>
                            <input type="text" class="form-control" id="cnpj" name="cnpj"
                                   placeholder="00.000.000/0000-00">
                        </div>
                        <div class="col-md-6">
                            <label for="inep" class="form-label">Código INEP</label>
                            <input type="text" class="form-control" id="inep" name="inep"
                                   placeholder="12345678">
                        </div>
                    </div>
                    
                    <!-- Contato -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h5 class="text-primary border-bottom pb-2">
                                <i class="fas fa-address-book me-2"></i>
                                Informações de Contato
                            </h5>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="email" class="form-label">Email da Escola</label>
                            <input type="email" class="form-control" id="email" name="email"
                                   placeholder="escola@municipio.gov.br">
                        </div>
                        <div class="col-md-3">
                            <label for="diretor_id" class="form-label">Diretor Responsável</label>
                            <select class="form-select" id="diretor_id" name="diretor_id">
                                <option value="">Selecione...</option>
                                <!-- Diretores serão carregados dinamicamente -->
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="diretor" class="form-label">Nome do Diretor (Texto)</label>
                            <input type="text" class="form-control" id="diretor" name="diretor"
                                   placeholder="Nome completo do diretor">
                        </div>
                    </div>
                    
                    <!-- Configurações Iniciais -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h5 class="text-primary border-bottom pb-2">
                                <i class="fas fa-cog me-2"></i>
                                Configurações Iniciais
                            </h5>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label for="situacao" class="form-label">Situação Inicial</label>
                            <select class="form-select" id="situacao" name="situacao">
                                <option value="ativa" selected>Ativa</option>
                                <option value="inativa">Inativa</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <div class="form-check mt-4">
                                <input class="form-check-input" type="checkbox" id="criar_admin" name="criar_admin" checked>
                                <label class="form-check-label" for="criar_admin">
                                    Criar usuário administrador da escola
                                </label>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-check mt-4">
                                <input class="form-check-input" type="checkbox" id="configuracoes_padrao" name="configuracoes_padrao" checked>
                                <label class="form-check-label" for="configuracoes_padrao">
                                    Aplicar configurações padrão
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Observações -->
                    <div class="row mb-3">
                        <div class="col-12">
                            <label for="observacoes" class="form-label">Observações</label>
                            <textarea class="form-control" id="observacoes" name="observacoes" rows="3"
                                      placeholder="Informações adicionais sobre a escola..."></textarea>
                        </div>
                    </div>
                    
                    <!-- Botões -->
                    <div class="row">
                        <div class="col-12">
                            <hr>
                            <div class="d-flex justify-content-end gap-2">
                                <a href="{{ url_for('escola.listar') }}" class="btn btn-secondary">
                                    <i class="fas fa-times me-2"></i>
                                    Cancelar
                                </a>
                                <button type="button" class="btn btn-outline-primary" onclick="salvarRascunho()">
                                    <i class="fas fa-save me-2"></i>
                                    Salvar Rascunho
                                </button>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-check me-2"></i>
                                    Cadastrar Escola
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Card de Ajuda -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card border-info">
            <div class="card-header bg-info text-white">
                <h6 class="mb-0">
                    <i class="fas fa-info-circle me-2"></i>
                    Informações Importantes
                </h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>Após o cadastro:</h6>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-check text-success me-2"></i>A escola será criada no sistema</li>
                            <li><i class="fas fa-check text-success me-2"></i>Configurações padrão serão aplicadas</li>
                            <li><i class="fas fa-check text-success me-2"></i>Usuário administrador será criado (se marcado)</li>
                            <li><i class="fas fa-check text-success me-2"></i>Log de auditoria será registrado</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6>Campos obrigatórios:</h6>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-asterisk text-danger me-2"></i>Nome da Escola</li>
                            <li><i class="fas fa-asterisk text-danger me-2"></i>UF (Estado)</li>
                        </ul>
                        <h6 class="mt-3">Campos recomendados:</h6>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-star text-warning me-2"></i>CNPJ</li>
                            <li><i class="fas fa-star text-warning me-2"></i>Código INEP</li>
                            <li><i class="fas fa-star text-warning me-2"></i>Email</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // Máscara para CNPJ
    $('#cnpj').mask('00.000.000/0000-00');
    
    // Validação do formulário
    $('#formEscola').on('submit', function(e) {
        var nome = $('#nome').val().trim();
        var uf = $('#uf').val();
        
        if (!nome || !uf) {
            e.preventDefault();
            alert('Por favor, preencha todos os campos obrigatórios (*)');
            return false;
        }
        
        // Validar CNPJ se preenchido
        var cnpj = $('#cnpj').val().replace(/\D/g, '');
        if (cnpj && cnpj.length !== 14) {
            e.preventDefault();
            alert('CNPJ deve ter 14 dígitos');
            $('#cnpj').focus();
            return false;
        }
        
        // Confirmar cadastro
        if (!confirm('Confirma o cadastro da escola "' + nome + '"?')) {
            e.preventDefault();
            return false;
        }
    });
    
    // Auto-completar campos baseado no nome
    $('#nome').on('blur', function() {
        var nome = $(this).val();
        if (nome && !$('#email').val()) {
            var emailSugerido = nome.toLowerCase()
                .replace(/[^a-z0-9\s]/g, '')
                .replace(/\s+/g, '')
                .substring(0, 20) + '@municipio.gov.br';
            $('#email').val(emailSugerido);
        }
    });
});

function salvarRascunho() {
    // Implementar salvamento de rascunho
    alert('Funcionalidade de rascunho será implementada');
}

// Incluir jQuery Mask Plugin
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
{% endblock %}
